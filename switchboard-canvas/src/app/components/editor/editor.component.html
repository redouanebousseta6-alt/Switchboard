<div class="h-screen flex flex-col bg-gray-50">
  <!-- Toolbar -->
  <div class="bg-white shadow-md px-6 py-3 flex items-center justify-between z-10">
    <div class="flex items-center space-x-4">
      <button 
        (click)="goBack()"
        class="text-gray-600 hover:text-gray-900 transition-colors"
        title="Back to Gallery">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      </button>
      <div>
        <input 
          [(ngModel)]="templateName" 
          class="text-lg font-semibold text-gray-900 bg-transparent border-b border-transparent hover:border-gray-300 focus:border-primary-500 focus:outline-none transition-colors px-1"
          placeholder="Template Name">
      </div>
    </div>
    
    <div class="flex items-center space-x-2">
      <!-- Undo/Redo -->
      <div class="flex items-center bg-gray-100 rounded-lg p-1 mr-2">
        <button 
          (click)="undo()"
          [disabled]="!canUndo"
          class="p-1.5 text-gray-700 hover:bg-white rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent"
          title="Undo (Ctrl+Z)">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
          </svg>
        </button>
        <button 
          (click)="redo()"
          [disabled]="!canRedo"
          class="p-1.5 text-gray-700 hover:bg-white rounded transition-colors disabled:opacity-30 disabled:hover:bg-transparent"
          title="Redo (Ctrl+Y)">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6" />
          </svg>
        </button>
      </div>

      <!-- Add Element Buttons -->
      <button 
        (click)="addTestImage()"
        class="px-3 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>Add Image</span>
      </button>
      <button 
        (click)="addTestText()"
        class="px-3 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
        </svg>
        <span>Add Text</span>
      </button>
      <button 
        (click)="addTestRectangle()"
        class="px-3 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
        </svg>
        <span>Add Rectangle</span>
      </button>
      
      <div class="border-l border-gray-300 h-8 mx-2"></div>
      
      <!-- Clipping Toggle -->
      <button 
        (click)="toggleClipping()"
        [class.bg-primary-50]="clippingEnabled"
        [class.text-primary-600]="clippingEnabled"
        [class.border-primary-300]="clippingEnabled"
        class="px-3 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm flex items-center space-x-2"
        title="Toggle clipping to canvas">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z" />
        </svg>
        <span>Clip: {{ clippingEnabled ? 'ON' : 'OFF' }}</span>
      </button>

      <!-- Zoom Controls -->
      <div class="flex items-center space-x-1 bg-gray-100 rounded-lg p-1">
        <button 
          (click)="zoomOut()"
          class="px-2 py-1 text-gray-700 hover:bg-white rounded transition-colors"
          title="Zoom Out">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7" />
          </svg>
        </button>
        <button 
          (click)="resetZoom()"
          class="px-2 py-1 text-gray-700 hover:bg-white rounded transition-colors text-xs font-medium min-w-[3rem]"
          title="Reset Zoom">
          {{ zoomLevel }}%
        </button>
        <button 
          (click)="zoomIn()"
          class="px-2 py-1 text-gray-700 hover:bg-white rounded transition-colors"
          title="Zoom In">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
          </svg>
        </button>
      </div>
      
      <div class="border-l border-gray-300 h-8 mx-2"></div>
      
      <button 
        (click)="saveTemplate()"
        [disabled]="isSaving"
        class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:bg-primary-400 transition-colors text-sm font-medium flex items-center space-x-2">
        <svg *ngIf="isSaving" class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span>{{ isSaving ? 'Saving...' : 'Save' }}</span>
      </button>

      <button 
        (click)="syncToApi()"
        [disabled]="isSaving"
        class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-indigo-400 transition-colors text-sm font-medium flex items-center space-x-2 shadow-sm"
        title="Publish to API Server">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
        <span>Publish</span>
      </button>

      <button 
        (click)="exportPNG()"
        class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium flex items-center space-x-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg>
        <span>Export</span>
      </button>

      <div class="border-l border-gray-300 h-8 mx-2"></div>

      <button 
        (click)="openApiSnippet()"
        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-bold flex items-center space-x-2 shadow-sm mr-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
        <span>Curl</span>
      </button>

      <button 
        (click)="toggleApiRunner()"
        class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-900 transition-colors text-sm font-bold flex items-center space-x-2 shadow-sm">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
        </svg>
        <span>API Runner</span>
      </button>
    </div>
  </div>

  <!-- Three-Pane Editor Layout -->
  <div class="flex-1 overflow-hidden">
    <as-split direction="horizontal" [gutterSize]="8" class="h-full">
      
      <!-- Left Panel: Sidebar (Library + Layers) -->
      <as-split-area [size]="20" [minSize]="15" [maxSize]="30">
        <div class="h-full border-r border-gray-800 bg-[#111827]">
          <app-sidebar 
            (openLibrary)="showLibrary = true" 
            (goHome)="goBack()">
          </app-sidebar>
        </div>
      </as-split-area>

      <!-- Center Panel: Infinite Workspace -->
      <as-split-area [size]="55" [minSize]="40">
        <div class="h-full bg-gray-200 overflow-auto workspace-scroll">
          <div class="canvas-container-infinite">
            <canvas id="fabric-canvas"></canvas>
          </div>
        </div>
      </as-split-area>

      <!-- Right Panel: Properties -->
      <as-split-area [size]="25" [minSize]="20" [maxSize]="35">
        <div class="h-full bg-white border-l border-gray-200">
          <app-properties (openFontLibrary)="openFontLibrary()"></app-properties>
        </div>
      </as-split-area>

    </as-split>
  </div>

  <!-- Image Library Modal -->
  <app-image-library 
    *ngIf="showImageLibrary" 
    (select)="onImageSelected($event)" 
    (close)="showImageLibrary = false">
  </app-image-library>

  <!-- API Runner Modal -->
  <app-api-runner
    *ngIf="showApiRunner"
    (apply)="onApplyOverwrites($event)"
    (close)="showApiRunner = false">
  </app-api-runner>

  <!-- Font Library Modal -->
  <app-font-library
    *ngIf="showFontLibrary"
    (select)="onFontSelected($event)"
    (close)="showFontLibrary = false">
  </app-font-library>

  <!-- Unified Asset Library Modal -->
  <app-library
    *ngIf="showLibrary"
    (selectImage)="onImageSelected($event)"
    (selectFont)="onFontSelected($event)"
    (close)="showLibrary = false">
  </app-library>

  <!-- API Snippet Modal -->
  <app-api-snippet
    *ngIf="showApiSnippet"
    [templateId]="apiTemplateId"
    [elements]="apiElements"
    [canvasWidth]="canvasDimensions.width"
    [canvasHeight]="canvasDimensions.height"
    (close)="showApiSnippet = false">
  </app-api-snippet>
</div>
