<div class="relative w-full">
  <label class="block text-xs text-gray-600 mb-1">{{ label }}</label>
  
  <!-- Trigger Button -->
  <div class="flex items-center space-x-2">
    <button 
      type="button"
      (click)="togglePicker()"
      class="h-10 w-16 border border-gray-300 rounded-lg shadow-sm hover:border-primary-500 transition-all flex-shrink-0"
      [style.background-color]="color">
    </button>
    <div class="flex-1 relative">
      <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-mono text-sm">#</span>
      <input 
        type="text" 
        [(ngModel)]="hexValue" 
        (input)="onHexInput()"
        maxlength="7"
        class="w-full pl-6 pr-3 py-2 border border-gray-300 rounded-lg text-sm font-mono focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all">
    </div>
  </div>

  <!-- Picker Dropdown -->
  <div *ngIf="showPicker" class="absolute left-0 mt-2 z-[100] bg-white rounded-2xl shadow-2xl border border-gray-100 p-4 w-[280px] animate-fade-in">
    
    <!-- Saturation Canvas -->
    <div class="relative w-full aspect-square rounded-xl overflow-hidden cursor-crosshair mb-4" 
         (mousedown)="onSaturationClick($event)"
         (mousemove)="onSaturationDrag($event)">
      <canvas #saturationCanvas width="248" height="248" class="w-full h-full"></canvas>
      <div class="absolute w-4 h-4 border-2 border-white rounded-full shadow-md -translate-x-1/2 -translate-y-1/2 pointer-events-none"
           [ngStyle]="getSaturationHandleStyle()"></div>
    </div>

    <!-- Hue Slider -->
    <div class="relative w-full h-4 rounded-full overflow-hidden cursor-pointer mb-6"
         (mousedown)="onHueClick($event)"
         (mousemove)="onHueDrag($event)">
      <canvas #hueCanvas width="248" height="16" class="w-full h-full"></canvas>
      <div class="absolute top-0 bottom-0 w-2 bg-white shadow-lg border border-gray-200 rounded-full -translate-x-1/2 pointer-events-none"
           [ngStyle]="getHueHandleStyle()"></div>
    </div>

    <!-- Inputs Row -->
    <div class="grid grid-cols-3 gap-2 mb-4">
      <div class="space-y-1">
        <label class="block text-[10px] font-bold text-gray-400 uppercase text-center">R</label>
        <input type="number" [(ngModel)]="r" (input)="onRgbInput()" min="0" max="255"
               class="w-full px-2 py-1.5 border border-gray-200 rounded-lg text-xs text-center focus:ring-1 focus:ring-primary-500 outline-none">
      </div>
      <div class="space-y-1">
        <label class="block text-[10px] font-bold text-gray-400 uppercase text-center">G</label>
        <input type="number" [(ngModel)]="g" (input)="onRgbInput()" min="0" max="255"
               class="w-full px-2 py-1.5 border border-gray-200 rounded-lg text-xs text-center focus:ring-1 focus:ring-primary-500 outline-none">
      </div>
      <div class="space-y-1">
        <label class="block text-[10px] font-bold text-gray-400 uppercase text-center">B</label>
        <input type="number" [(ngModel)]="b" (input)="onRgbInput()" min="0" max="255"
               class="w-full px-2 py-1.5 border border-gray-200 rounded-lg text-xs text-center focus:ring-1 focus:ring-primary-500 outline-none">
      </div>
    </div>

    <!-- Hex Display -->
    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-xl">
      <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Hex</span>
      <span class="text-sm font-mono font-bold text-gray-700">{{ hexValue.toUpperCase() }}</span>
    </div>
  </div>
</div>
